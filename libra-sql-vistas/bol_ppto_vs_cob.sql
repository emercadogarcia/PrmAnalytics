
(
SELECT PPTO_EJERCICIO AS EJERCICIO, PPTO_PERIODO AS PERIODO, D_VALOR_CLAVE AS RPN3, CODIGO_CLIENTE AS CODIGO_CLIENTE, CLIENTE_NOMBRE AS CLIENTE_NOMBRE, REG, CADENA,CANAL_VENTA, TIPO_CARTERA AS TIPO_CARTERA, PPTO, 0 AS COBRANZA 
    FROM (
        SELECT V.EJERCICIO AS PPTO_EJERCICIO, V.PERIODO AS PPTO_PERIODO,Clientes_claves_estadisticas.* ,CLIENTES.NOMBRE as CLIENTE_NOMBRE, V.ARTICULO AS CODIGO_CARTERA, A.DESCRIP_COMERCIAL AS TIPO_CARTERA, V.IMPORTE AS PPTO,(SELECT lvce.nombre FROM claves_estadisticas lvce WHERE lvce.clave = clientes_claves_estadisticas.clave)  D_CLAVE,(SELECT lvc.nombre FROM valores_claves lvc WHERE lvc.clave = clientes_claves_estadisticas.clave AND lvc.valor_clave = clientes_claves_estadisticas.valor_clave) D_VALOR_CLAVE,CLAVE V_CLAVE,VALOR_CLAVE V_VALOR_CLAVE,VALOR_NUMERICO V_VALOR_NUMERICO, decode(CLIENTES.ZONA,'0410','SCZ','0420','LPZ','0430','CBBA','0440','TJA','0450','ALTO','0451','ALTO','0460','SCR','0461','SCR','0470','BENI','0471','BENI','SIN REG') REG, (SELECT VC.NOMBRE FROM CLIENTES_CLAVES_ESTADISTICAS CCE, VALORES_CLAVES VC WHERE CLIENTES.CODIGO_EMPRESA='004' AND CLIENTES.CODIGO_EMPRESA=CCE.CODIGO_EMPRESA AND CLIENTES.CODIGO_RAPIDO=CCE.CODIGO_CLIENTE AND CCE.CLAVE=VC.CLAVE AND CCE.VALOR_CLAVE=VC.VALOR_CLAVE AND CCE.CLAVE='CADN') CADENA, (SELECT VC.NOMBRE FROM CLIENTES_CLAVES_ESTADISTICAS CCE, VALORES_CLAVES VC WHERE CLIENTES.CODIGO_EMPRESA='004' AND CLIENTES.CODIGO_EMPRESA=CCE.CODIGO_EMPRESA AND CLIENTES.CODIGO_RAPIDO=CCE.CODIGO_CLIENTE AND CCE.CLAVE=VC.CLAVE AND CCE.VALOR_CLAVE=VC.VALOR_CLAVE AND CCE.CLAVE='CANALV') CANAL_VENTA
        FROM clientes_claves_estadisticas, CLIENTES, V_XLS_PLANES_VENTAS V, ARTICULOS A 
        WHERE A.CODIGO_ARTICULO = V.ARTICULO AND A.CODIGO_EMPRESA='004' AND CLIENTES.CODIGO_RAPIDO = CLIENTES_CLAVES_ESTADISTICAS.CODIGO_CLIENTE AND CLIENTES.CODIGO_EMPRESA='004' AND CLIENTES_CLAVES_ESTADISTICAS.CODIGO_EMPRESA='004' AND V.CLIENTE=CLIENTES.CODIGO_RAPIDO AND CLIENTES_CLAVES_ESTADISTICAS.CODIGO_CLIENTE=V.CLIENTE AND V.EMPRESA='004' AND CLAVE='RPN3' AND V.CODIGO IN (1085))
clientes_claves_estadisticas 
UNION ALL
/*COBRANZA*/
SELECT COB.EJERCICIO AS EJERCICIO, COB.PERIODO AS PERIODO, RPN.RPN3 AS RPN3, COB.CODIGO_CLIENTE AS CODIGO_CLIENTE, RPN.CLIENTE_NOMBRE AS CLIENTE_NOMBRE, RPN.REG AS REG, RPN.CADENA AS CADENA, RPN.CANAL_VENTA AS CANAL_VENTA, COB.TIPO_CARTERA AS TIPO_CARTERA, 0 AS PPTO, SUM(COB.IMPORTE) AS COBRANZA
FROM (
        SELECT TO_NUMBER(to_char(HDA.FECHA_ASIENTO,'YYYY'),'9999') AS EJERCICIO, TO_NUMBER(to_char(HDA.FECHA_ASIENTO,'MM'),'99') AS PERIODO, HC.CODIGO_CLIENTE, HDA.FECHA_ASIENTO, HMC.DOCUMENTO, HC.FECHA_VENCIMIENTO, HMC.IMPORTE_MOV AS IMPORTE,'PPTO COBRANZA MOROSA' AS TIPO_CARTERA
        FROM HISTORICO_MOV_CARTERA HMC, HISTORICO_COBROS HC, HISTORICO_DETALLADO_APUNTES HDA
        WHERE HMC.DOCUMENTO=HC.DOCUMENTO AND HMC.FECHA_FACTURA=HC.FECHA_FACTURA AND HMC.FECHA_VENCIMIENTO=HC.FECHA_VENCIMIENTO AND HMC.TIPO_TRANSACCION=HC.TIPO_TRANSACCION AND HMC.EMPRESA=HC.EMPRESA AND HMC.FECHA_VENCIMIENTO < TRUNC(add_months(SYSDATE,-1),'MONTH') AND
        HMC.EMPRESA=HDA.EMPRESA AND HMC.FECHA_ASIENTO=HDA.FECHA_ASIENTO AND HMC.NUMERO_ASIENTO_BORRADOR=HDA.NUMERO_ASIENTO_BORRADOR AND 
        HMC.TIPO_MOVIMIENTO='CONSR' AND HDA.ENTIDAD='BA'AND HMC.EMPRESA ='004' AND HMC.TIPO_MOVIMIENTO = 'CONSR' /*AND HDA.FECHA_ASIENTO BETWEEN TRUNC(SYSDATE,'MONTH') and TRUNC(SYSDATE)*/
        UNION ALL
        SELECT TO_NUMBER(to_char(HDA.FECHA_ASIENTO,'YYYY'),'9999') AS EJERCICIO, TO_NUMBER(to_char(HDA.FECHA_ASIENTO,'MM'),'99') AS PERIODO, HC.CODIGO_CLIENTE, HDA.FECHA_ASIENTO, HMC.DOCUMENTO, HC.FECHA_VENCIMIENTO, HMC.IMPORTE_MOV AS IMPORTE, 'PPTO COBRANZA CORRIENTE' AS TIPO_CARTERA
        FROM HISTORICO_MOV_CARTERA HMC, HISTORICO_COBROS HC, HISTORICO_DETALLADO_APUNTES HDA
        WHERE HMC.DOCUMENTO=HC.DOCUMENTO AND HMC.FECHA_FACTURA=HC.FECHA_FACTURA AND HMC.FECHA_VENCIMIENTO=HC.FECHA_VENCIMIENTO AND HMC.TIPO_TRANSACCION=HC.TIPO_TRANSACCION AND HMC.EMPRESA=HC.EMPRESA AND HMC.FEC